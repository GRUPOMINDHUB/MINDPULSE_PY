<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Relatorio de Performance Individual</title>
    <style type="text/css">
        @page {
            size: A4 portrait;
            margin: 1.2cm;
        }
        
        body {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 9pt;
            color: #1E293B;
            margin: 0;
            padding: 0;
            background-color: #FFFFFF;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        /* Header de Marca */
        .header-bar {
            width: 100%;
            height: 4px;
            background-color: #F83531;
            margin-bottom: 15px;
        }
        
        .header-table {
            width: 100%;
            border-bottom: 2px solid #E2E8F0;
            padding-bottom: 12px;
            margin-bottom: 20px;
        }
        
        .header-table td {
            padding: 6px 4px;
            vertical-align: middle;
        }
        
        .logo-cell {
            font-size: 20pt;
            font-weight: bold;
            color: #F83531;
            width: 20%;
        }
        
        .title-cell {
            font-size: 14pt;
            font-weight: 600;
            color: #1E293B;
            text-align: center;
            width: 60%;
        }
        
        .info-cell {
            font-size: 8pt;
            color: #64748B;
            text-align: right;
            width: 20%;
        }
        
        .company-name {
            font-weight: 600;
            color: #1E293B;
            font-size: 9pt;
            margin-bottom: 3px;
        }
        
        /* Profile Section */
        .profile-section {
            background-color: #F8FAFC;
            border: 1px solid #E2E8F0;
            padding: 15px;
            margin-bottom: 18px;
        }
        
        .profile-name {
            font-size: 16pt;
            font-weight: 700;
            color: #1E293B;
            margin-bottom: 8px;
        }
        
        .profile-details {
            font-size: 8.5pt;
            color: #64748B;
            line-height: 1.6;
        }
        
        .profile-details strong {
            color: #1E293B;
            font-weight: 600;
        }
        
        /* Metric Cards */
        .metrics-table {
            margin: 20px 0;
        }
        
        .metrics-table td {
            background-color: #F8FAFC;
            border: 1px solid #E2E8F0;
            padding: 15px 12px;
            vertical-align: top;
            width: 33.33%;
            text-align: center;
        }
        
        .metric-label {
            font-size: 8pt;
            color: #64748B;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 8px;
        }
        
        .metric-value {
            font-size: 28pt;
            font-weight: 700;
            color: #F83531;
            line-height: 1;
            margin: 6px 0;
        }
        
        .metric-detail {
            font-size: 7.5pt;
            color: #94A3B8;
            margin-top: 6px;
        }
        
        /* Section Title */
        .section-title {
            color: #1E293B;
            font-size: 11pt;
            font-weight: 600;
            margin: 25px 0 12px 0;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            border-bottom: 2px solid #F83531;
            padding-bottom: 5px;
        }
        
        /* Checklist Stats */
        .checklist-stats {
            margin: 15px 0;
        }
        
        .checklist-stats td {
            padding: 12px;
            border: 1px solid #E2E8F0;
            background-color: #FFFFFF;
            vertical-align: middle;
        }
        
        .stat-label {
            font-size: 9pt;
            color: #64748B;
            font-weight: 600;
            width: 50%;
        }
        
        .stat-value {
            font-size: 11pt;
            color: #1E293B;
            font-weight: 700;
            text-align: right;
            width: 50%;
        }
        
        .progress-bar-container {
            width: 100%;
            background-color: #E2E8F0;
            height: 12px;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 6px;
        }
        
        .progress-bar {
            height: 100%;
            background-color: #F83531;
        }
        
        /* Training Cards */
        .training-card {
            background-color: #F8FAFC;
            border: 1px solid #E2E8F0;
            padding: 14px;
            margin-bottom: 12px;
        }
        
        .training-title {
            font-size: 10pt;
            font-weight: 600;
            color: #1E293B;
            margin-bottom: 8px;
        }
        
        .training-stats {
            font-size: 8pt;
            color: #64748B;
            margin-bottom: 6px;
        }
        
        .training-stats strong {
            color: #1E293B;
        }
        
        .training-progress {
            margin-top: 8px;
        }
        
        .quiz-score {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 9pt;
            font-weight: 600;
            margin-top: 6px;
        }
        
        .quiz-passed {
            background-color: #D1FAE5;
            color: #065F46;
        }
        
        .quiz-failed {
            background-color: #FEE2E2;
            color: #991B1B;
        }
        
        /* Warnings Table */
        .warnings-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 8.5pt;
        }
        
        .warnings-table thead {
            background-color: #1E293B;
            color: #FFFFFF;
        }
        
        .warnings-table thead th {
            padding: 10px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 8pt;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: none;
        }
        
        .warnings-table tbody tr {
            border-bottom: 1px solid #E2E8F0;
        }
        
        .warnings-table tbody tr:nth-child(even) {
            background-color: #F9FAFB;
        }
        
        .warnings-table tbody td {
            padding: 10px 8px;
            border: none;
            vertical-align: top;
        }
        
        .warning-type {
            font-weight: 600;
            color: #1E293B;
        }
        
        .warning-reason {
            font-style: italic;
            color: #64748B;
            font-size: 8pt;
            line-height: 1.4;
        }
        
        .warning-issuer {
            font-size: 7.5pt;
            color: #94A3B8;
        }
        
        /* Footer */
        .footer {
            border-top: 1px solid #E2E8F0;
            padding: 10px 0;
            margin-top: 20px;
            text-align: center;
            font-size: 7.5pt;
            color: #94A3B8;
        }
        
        /* Completions Table */
        .completions-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 8.5pt;
        }
        
        .completions-table thead {
            background-color: #1E293B;
            color: #FFFFFF;
        }
        
        .completions-table thead th {
            padding: 10px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 8pt;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .completions-table tbody tr {
            border-bottom: 1px solid #E2E8F0;
        }
        
        .completions-table tbody tr:nth-child(even) {
            background-color: #F9FAFB;
        }
        
        .completions-table tbody td {
            padding: 10px 8px;
            border: none;
        }
        
        .points-value {
            font-weight: 700;
            color: #F83531;
        }
    </style>
</head>
<body>
    <!-- Header de Marca -->
    <div class="header-bar"></div>
    
    <table class="header-table">
        <tr>
            <td class="logo-cell">MINDPULSE</td>
            <td class="title-cell">Relatorio de Performance Individual</td>
            <td class="info-cell">
                <div class="company-name">{{ report_data.company.name }}</div>
                <div>Periodo: {{ report_data.start_date|date:"d/m/Y" }} - {{ report_data.end_date|date:"d/m/Y" }}</div>
                <div style="margin-top: 3px;">Emitido em: {{ report_data.generated_at|date:"d/m/Y H:i" }}</div>
            </td>
        </tr>
    </table>
    
    <!-- Perfil do Colaborador -->
    <div class="profile-section">
        <div class="profile-name">{% if report_data.profile.name %}{{ report_data.profile.name }}{% else %}Colaborador{% endif %}</div>
        <table style="width: 100%;">
            <tr>
                <td style="width: 50%;" class="profile-details">
                    <strong>Email:</strong> {% if report_data.profile.email %}{{ report_data.profile.email }}{% else %}---{% endif %}<br>
                    <strong>Telefone:</strong> {% if report_data.profile.phone %}{{ report_data.profile.phone }}{% else %}---{% endif %}<br>
                    <strong>Idade:</strong> {% if report_data.profile.age %}{{ report_data.profile.age }} anos{% else %}---{% endif %}
                </td>
                <td style="width: 50%;" class="profile-details">
                    <strong>Data de Nascimento:</strong> {% if report_data.profile.birth_date %}{{ report_data.profile.birth_date }}{% else %}---{% endif %}<br>
                    <strong>Cidade:</strong> {% if report_data.profile.city %}{{ report_data.profile.city }}{% else %}---{% endif %}<br>
                    <strong>Bairro:</strong> {% if report_data.profile.neighborhood %}{{ report_data.profile.neighborhood }}{% else %}---{% endif %}
                </td>
            </tr>
        </table>
    </div>
    
    <!-- Metric Cards: Ranking, Pontos, Média -->
    <table class="metrics-table">
        <tr>
            <td>
                <div class="metric-label">Posicao no Ranking</div>
                <div class="metric-value">{% if report_data.ranking.position %}{{ report_data.ranking.position }}º{% else %}---{% endif %}</div>
                <div class="metric-detail">de {% if report_data.ranking.total_users %}{{ report_data.ranking.total_users }}{% else %}0{% endif %} colaboradores</div>
            </td>
            <td>
                <div class="metric-label">Saldo de Pontos</div>
                <div class="metric-value">{% if report_data.ranking.total_points %}{{ report_data.ranking.total_points }}{% else %}0{% endif %}</div>
                <div class="metric-detail">Pontos acumulados</div>
            </td>
            <td>
                <div class="metric-label">Media de Excelencia</div>
                <div class="metric-value">{% if report_data.quizzes.avg_score %}{{ report_data.quizzes.avg_score|floatformat:1 }}{% else %}0.0{% endif %}%</div>
                <div class="metric-detail">Media geral de quizzes</div>
            </td>
        </tr>
    </table>
    
    <!-- Checklists & Operação -->
    <div class="section-title">Checklists & Operacao</div>
    
    <table class="checklist-stats">
        <tr>
            <td class="stat-label">Checklists Concluidos (Periodo):</td>
            <td class="stat-value">{% if report_data.checklists.total_completed_period %}{{ report_data.checklists.total_completed_period }}{% else %}0{% endif %}</td>
        </tr>
        <tr>
            <td class="stat-label">Tarefas Concluidas (Periodo):</td>
            <td class="stat-value">{% if report_data.checklists.total_tasks_completed_period %}{{ report_data.checklists.total_tasks_completed_period }}{% else %}0{% endif %}</td>
        </tr>
        <tr>
            <td colspan="2" style="padding-top: 10px;">
                <div style="font-size: 8.5pt; color: #64748B; margin-bottom: 4px;">
                    Progresso Geral: 
                    <strong style="color: #1E293B;">
                        {% if report_data.checklists.total_completed_all %}{{ report_data.checklists.total_completed_all }}{% else %}0{% endif %} checklists concluidos
                    </strong>
                </div>
                {% if report_data.checklists.total_completed_all > 0 %}
                {% widthratio report_data.checklists.total_completed_all 10 100 as progress_width %}
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: {% if progress_width > 100 %}100{% else %}{{ progress_width }}{% endif %}%;"></div>
                </div>
                {% else %}
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: 0%;"></div>
                </div>
                {% endif %}
            </td>
        </tr>
        {% if report_data.checklists.overdue_count > 0 %}
        <tr>
            <td colspan="2" style="padding-top: 10px; color: #EF4444; font-weight: 600;">
                ⚠️ Checklists Atrasados: {{ report_data.checklists.overdue_count }}
            </td>
        </tr>
        {% endif %}
    </table>
    
    {% if report_data.checklists.completions %}
    <table class="completions-table">
        <thead>
            <tr>
                <th>Checklist</th>
                <th>Data de Conclusao</th>
                <th>Pontos</th>
            </tr>
        </thead>
        <tbody>
            {% for comp in report_data.checklists.completions %}
            <tr>
                <td>{{ comp.checklist }}</td>
                <td>{{ comp.date }}</td>
                <td class="points-value">{{ comp.points }} pts</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
    
    <!-- Trilha de Aprendizagem -->
    <div class="section-title">Trilha de Aprendizagem - Treinamentos</div>
    
    {% if report_data.trainings.trainings %}
        {% for training in report_data.trainings.trainings %}
        <div class="training-card">
            <div class="training-title">{{ training.title }}</div>
            <div class="training-stats">
                <strong>Videos:</strong> {{ training.completed_videos }}/{{ training.total_videos }} concluidos | 
                <strong>Quizzes:</strong> {{ training.passed_quizzes }}/{{ training.total_quizzes }} aprovados
            </div>
            <div class="training-progress">
                <div style="font-size: 8pt; color: #64748B; margin-bottom: 4px;">
                    Progresso: <strong style="color: #1E293B;">{{ training.progress }}%</strong>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" style="width: {% if training.progress > 100 %}100{% else %}{{ training.progress }}{% endif %}%;"></div>
                </div>
            </div>
            {% if training.is_completed %}
            <div style="margin-top: 6px;">
                <span class="quiz-score quiz-passed">✓ Concluido</span>
            </div>
            {% elif training.is_started %}
            <div style="margin-top: 6px;">
                <span class="quiz-score" style="background-color: #FEF3C7; color: #92400E;">Em Andamento</span>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    {% else %}
        <div style="padding: 15px; text-align: center; color: #64748B;">Nenhum treinamento atribuido neste periodo.</div>
    {% endif %}
    
    <!-- Quizzes Detalhados -->
    {% if report_data.quizzes.attempts %}
    <div class="section-title">Historico de Avaliacoes</div>
    <table class="completions-table">
        <thead>
            <tr>
                <th>Quiz</th>
                <th>Treinamento</th>
                <th>Nota</th>
                <th>Status</th>
                <th>Data</th>
            </tr>
        </thead>
        <tbody>
            {% for attempt in report_data.quizzes.attempts %}
            <tr>
                <td>{{ attempt.quiz_title }}</td>
                <td>{{ attempt.training_title }}</td>
                <td class="points-value">{{ attempt.score|floatformat:1 }}%</td>
                <td>
                    {% if attempt.is_passed %}
                    <span class="quiz-score quiz-passed">Aprovado</span>
                    {% else %}
                    <span class="quiz-score quiz-failed">Reprovado</span>
                    {% endif %}
                </td>
                <td>{{ attempt.date }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
    
    <!-- Histórico Disciplinar -->
    {% if report_data.warnings.warnings %}
    <div class="section-title">Historico Disciplinar</div>
    <table class="warnings-table">
        <thead>
            <tr>
                <th style="width: 15%;">Data</th>
                <th style="width: 15%;">Tipo</th>
                <th style="width: 50%;">Motivo</th>
                <th style="width: 20%;">Aplicado por</th>
            </tr>
        </thead>
        <tbody>
            {% for warning in report_data.warnings.warnings %}
            <tr>
                <td>{{ warning.date }}</td>
                <td class="warning-type">{{ warning.type }}</td>
                <td class="warning-reason">{{ warning.reason }}</td>
                <td class="warning-issuer">{{ warning.issuer }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="section-title">Historico Disciplinar</div>
    <div style="padding: 15px; text-align: center; color: #64748B; font-style: italic;">Nenhuma advertencia registrada.</div>
    {% endif %}
    
    <!-- Footer -->
    <div class="footer">
        <strong>Mindpulse</strong> - Inteligencia Operacional | 
        {{ report_data.company.name }} | 
        Relatorio gerado em {{ report_data.generated_at|date:"d/m/Y H:i" }}
    </div>
</body>
</html>
