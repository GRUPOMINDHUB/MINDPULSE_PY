<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Relatorio de Performance Operacional</title>
    <style type="text/css">
        @page {
            size: A4 landscape;
            margin: 1cm;
        }
        
        body {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 9pt;
            color: #1E293B;
            margin: 0;
            padding: 0;
            background-color: #FFFFFF;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        /* Header de Consultoria */
        .header-table {
            width: 100%;
            border-bottom: 3px solid #F83531;
            padding-bottom: 10px;
            margin-bottom: 18px;
        }
        
        .header-table td {
            padding: 6px 4px;
            vertical-align: middle;
        }
        
        .logo-cell {
            font-size: 18pt;
            font-weight: bold;
            color: #F83531;
            width: 18%;
        }
        
        .divider-cell {
            width: 2px;
            background-color: #E2E8F0;
            padding: 0;
        }
        
        .title-cell {
            font-size: 14pt;
            font-weight: 600;
            color: #1E293B;
            padding-left: 12px;
            text-align: left;
            width: 45%;
        }
        
        .info-cell {
            font-size: 8pt;
            color: #64748B;
            text-align: right;
            width: 35%;
        }
        
        .company-name {
            font-weight: 600;
            color: #1E293B;
            font-size: 9pt;
            margin-bottom: 3px;
        }
        
        /* KPI Cards Dashboard */
        .kpi-table {
            margin: 18px 0;
        }
        
        .kpi-table td {
            background-color: #F8FAFC;
            border-bottom: 3px solid #F83531;
            padding: 14px 12px;
            vertical-align: top;
            width: 25%;
        }
        
        .kpi-label {
            font-size: 7.5pt;
            color: #64748B;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 8px;
        }
        
        .kpi-value {
            font-size: 32pt;
            font-weight: 700;
            color: #F83531;
            line-height: 1;
            margin: 6px 0 8px 0;
        }
        
        .kpi-detail {
            font-size: 7pt;
            color: #94A3B8;
            line-height: 1.3;
        }
        
        /* Section Title */
        .section-title {
            color: #1E293B;
            font-size: 11pt;
            font-weight: 600;
            margin: 20px 0 12px 0;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            border-bottom: 2px solid #F83531;
            padding-bottom: 5px;
        }
        
        /* Pódio */
        .podium-table {
            margin: 15px 0;
        }
        
        .podium-table td {
            text-align: center;
            vertical-align: top;
            padding: 12px 10px;
            border: 2px solid #DDDDDD;
            background-color: #FFFFFF;
            width: 33.33%;
        }
        
        .podium-first {
            border-color: #FFD700;
            background-color: #FFFEF0;
        }
        
        .podium-second {
            border-color: #C0C0C0;
            background-color: #F8F8F8;
        }
        
        .podium-third {
            border-color: #CD7F32;
            background-color: #FFF8F0;
        }
        
        .podium-name {
            font-size: 10pt;
            font-weight: 600;
            color: #1E293B;
            margin: 6px 0;
        }
        
        .podium-points {
            font-size: 18pt;
            font-weight: 700;
            color: #F83531;
            margin: 6px 0;
        }
        
        .podium-stats {
            font-size: 7.5pt;
            color: #64748B;
            margin-top: 6px;
            line-height: 1.3;
        }
        
        /* Attention Box */
        .attention-box {
            background-color: #FFF5F5;
            border: 2px solid #F83531;
            padding: 12px;
            margin: 15px 0;
        }
        
        .attention-title {
            color: #F83531;
            font-size: 9.5pt;
            font-weight: 600;
            margin: 0 0 10px 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .attention-table {
            width: 100%;
        }
        
        .attention-table td {
            background-color: #FFFFFF;
            border: 1px solid #FCA5A5;
            padding: 10px;
            vertical-align: top;
            width: 33.33%;
        }
        
        .attention-name {
            font-weight: 600;
            font-size: 9pt;
            color: #1E293B;
            margin-bottom: 5px;
        }
        
        .attention-score {
            color: #F83531;
            font-weight: 700;
            font-size: 12pt;
            margin: 5px 0;
        }
        
        .attention-detail {
            font-size: 7.5pt;
            color: #64748B;
            line-height: 1.3;
        }
        
        /* Performance Table */
        .perf-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 8.5pt;
        }
        
        .perf-table thead {
            background-color: #1E293B;
            color: #FFFFFF;
        }
        
        .perf-table thead th {
            padding: 10px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 8pt;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: none;
            border-bottom: 2px solid #0F172A;
        }
        
        .perf-table tbody tr {
            border-bottom: 1px solid #E2E8F0;
        }
        
        .perf-table tbody tr:nth-child(even) {
            background-color: #F9FAFB;
        }
        
        .perf-table tbody tr:nth-child(odd) {
            background-color: #FFFFFF;
        }
        
        .perf-table tbody td {
            padding: 10px 8px;
            border: none;
            border-bottom: 1px solid #E2E8F0;
            vertical-align: middle;
        }
        
        .employee-name {
            font-weight: 600;
            color: #1E293B;
            font-size: 9pt;
        }
        
        .employee-email {
            font-size: 7pt;
            color: #94A3B8;
            margin-top: 2px;
        }
        
        /* Progress Bar */
        .progress-container {
            width: 100%;
            background-color: #E2E8F0;
            height: 8px;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 4px;
        }
        
        .progress-bar {
            height: 100%;
            background-color: #F83531;
        }
        
        .percent-value {
            font-weight: 600;
            font-size: 9pt;
            color: #1E293B;
        }
        
        .points-value {
            font-weight: 700;
            font-size: 10pt;
            color: #F83531;
        }
        
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 7.5pt;
            font-weight: 600;
        }
        
        .status-critical {
            background-color: #FEE2E2;
            color: #991B1B;
        }
        
        .status-excellent {
            background-color: #D1FAE5;
            color: #065F46;
        }
        
        .status-regular {
            background-color: #FEF3C7;
            color: #92400E;
        }
        
        /* Footer */
        .footer {
            border-top: 1px solid #E2E8F0;
            padding: 10px 0;
            margin-top: 20px;
            text-align: center;
            font-size: 7.5pt;
            color: #94A3B8;
        }
    </style>
</head>
<body>
    <!-- Header de Consultoria -->
    <table class="header-table">
        <tr>
            <td class="logo-cell">MINDPULSE</td>
            <td class="divider-cell"></td>
            <td class="title-cell">Relatorio de Performance Operacional</td>
            <td class="info-cell">
                <div class="company-name">{{ report_data.company.name }}</div>
                <div>Periodo: {{ report_data.start_date|date:"d/m/Y" }} - {{ report_data.end_date|date:"d/m/Y" }}</div>
                <div style="margin-top: 3px;">Emitido em: {{ report_data.generated_at|date:"d/m/Y H:i" }}</div>
            </td>
        </tr>
    </table>
    
    <!-- Dashboard KPI Cards -->
    <table class="kpi-table">
        <tr>
            <td>
                <div class="kpi-label">Conformidade Checklists</div>
                <div class="kpi-value">{{ report_data.checklist_average|default:0|floatformat:1 }}%</div>
                <div class="kpi-detail">
                    {{ report_data.total_tasks_completed|default:0 }} tarefas concluidas<br>
                    {{ report_data.total_completions|default:0 }} checklists completos
                </div>
            </td>
            <td>
                <div class="kpi-label">Engajamento Treinamentos</div>
                <div class="kpi-value">{{ report_data.training_average|default:0|floatformat:1 }}%</div>
                <div class="kpi-detail">
                    Progresso medio da equipe<br>
                    Conclusao de videos e quizzes
                </div>
            </td>
            <td>
                <div class="kpi-label">Excelencia em Quizzes</div>
                <div class="kpi-value">{{ report_data.quiz_average_all|default:0|floatformat:1 }}%</div>
                <div class="kpi-detail">
                    Media geral de notas<br>
                    Desempenho em avaliacoes
                </div>
            </td>
            <td>
                <div class="kpi-label">Alertas Disciplinares</div>
                <div class="kpi-value">{{ report_data.total_warnings|default:0 }}</div>
                <div class="kpi-detail">
                    Advertencias aplicadas<br>
                    Oral: {{ report_data.warnings_by_type.oral|default:0 }} | 
                    Escrita: {{ report_data.warnings_by_type.escrita|default:0 }}<br>
                    Suspensao: {{ report_data.warnings_by_type.suspensao|default:0 }}
                </div>
            </td>
        </tr>
    </table>
    
    <!-- Top 3 Ranking -->
    {% if report_data.top_3 %}
    <div class="section-title">Ranking Geral - Top 3 Colaboradores</div>
    <table class="podium-table">
        <tr>
            {% for item in report_data.top_3 %}
            <td class="{% if forloop.counter == 1 %}podium-first{% elif forloop.counter == 2 %}podium-second{% else %}podium-third{% endif %}">
                <div style="font-size: 20pt; margin-bottom: 5px;">{% if forloop.counter == 1 %}1{% elif forloop.counter == 2 %}2{% else %}3{% endif %} LUGAR</div>
                <div class="podium-name">{{ item.name|default:"-" }}</div>
                <div class="podium-points">{{ item.points_earned|default:0 }} pts</div>
                <div class="podium-stats">
                    Checklists: {{ item.checklist_percentage|default:0|floatformat:1 }}%<br>
                    Treinamentos: {{ item.training_percentage|default:0|floatformat:1 }}%<br>
                    Quizzes: {{ item.quiz_average|default:0.0|floatformat:1 }}%
                </div>
            </td>
            {% endfor %}
        </tr>
    </table>
    {% endif %}
    
    <!-- Índice de Atenção -->
    {% if report_data.attention_list %}
    <div class="attention-box">
        <div class="attention-title">Indice de Atencao - Colaboradores que Requerem Acao Imediata</div>
        <table class="attention-table">
            <tr>
                {% for item in report_data.attention_list %}
                <td>
                    <div class="attention-name">{{ item.name|default:"-" }}</div>
                    <div class="attention-score">{{ item.attention_score|default:0 }} pontos</div>
                    <div class="attention-detail">
                        <strong>Atrasos:</strong> {{ item.checklist_overdue|default:0 }} checklist{% if item.checklist_overdue|default:0 != 1 %}s{% endif %}<br>
                        <strong>Advertencias:</strong> {{ item.warnings_count|default:0 }} aplicada{% if item.warnings_count|default:0 != 1 %}s{% endif %}
                    </div>
                </td>
                {% endfor %}
            </tr>
        </table>
    </div>
    {% endif %}
    
    <!-- Tabela de Performance da Equipe -->
    <div class="section-title">Matriz de Performance da Equipe</div>
    {% if report_data.performance_data %}
    <table class="perf-table">
        <thead>
            <tr>
                <th style="width: 22%;">Colaborador</th>
                <th style="width: 18%;">Checklists</th>
                <th style="width: 18%;">Treinamentos</th>
                <th style="width: 12%;">Quizzes</th>
                <th style="width: 10%;">Advertencias</th>
                <th style="width: 10%;">Pontos</th>
                <th style="width: 10%;">Status</th>
            </tr>
        </thead>
        <tbody>
            {% for item in report_data.performance_data %}
            <tr>
                <td>
                    <div class="employee-name">{% if item.name %}{{ item.name }}{% else %}N/A{% endif %}</div>
                    <div class="employee-email">{% if item.email %}{{ item.email }}{% else %}-{% endif %}</div>
                </td>
                <td>
                    <div class="percent-value">{{ item.checklist_percentage|default:0|floatformat:1 }}%</div>
                    <div class="progress-container">
                        {% with pct=item.checklist_percentage|default:0 %}
                        <div class="progress-bar" style="width: {% if pct %}{{ pct|floatformat:0 }}{% else %}0{% endif %}%;"></div>
                        {% endwith %}
                    </div>
                    {% if item.checklist_overdue|default:0 > 0 %}
                    <div style="font-size: 7pt; color: #EF4444; margin-top: 3px;">{{ item.checklist_overdue|default:0 }} atraso{% if item.checklist_overdue|default:0 != 1 %}s{% endif %}</div>
                    {% endif %}
                </td>
                <td>
                    <div class="percent-value">{{ item.training_percentage|default:0|floatformat:1 }}%</div>
                    <div class="progress-container">
                        {% with pct=item.training_percentage|default:0 %}
                        <div class="progress-bar" style="width: {% if pct %}{{ pct|floatformat:0 }}{% else %}0{% endif %}%;"></div>
                        {% endwith %}
                    </div>
                </td>
                <td>
                    <div class="percent-value">{{ item.quiz_average|default:0.0|floatformat:1 }}%</div>
                </td>
                <td style="text-align: center;">
                    {% if item.warnings_count|default:0 > 0 %}
                    <span style="font-weight: 600; color: #EF4444;">{{ item.warnings_count }}</span>
                    {% else %}
                    <span style="font-weight: 600; color: #10B981;">0</span>
                    {% endif %}
                </td>
                <td>
                    <div class="points-value">{{ item.points_earned|default:0 }}</div>
                </td>
                <td style="text-align: center;">
                    {% if item.checklist_overdue|default:0 > 2 or item.warnings_count|default:0 > 2 %}
                    <span class="status-badge status-critical">Critico</span>
                    {% elif item.checklist_percentage|default:0 >= 80 and item.training_percentage|default:0 >= 80 %}
                    <span class="status-badge status-excellent">Excelente</span>
                    {% else %}
                    <span class="status-badge status-regular">Regular</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div style="padding: 20px; text-align: center; color: #64748B;">Nenhum dado disponivel para este periodo.</div>
    {% endif %}
    
    <!-- Footer -->
    <div class="footer">
        <strong>Mindpulse</strong> - Inteligencia Operacional | 
        {% if report_data.company %}{{ report_data.company.name }}{% else %}N/A{% endif %} | 
        Total de colaboradores: {{ report_data.total_users|default:0 }} | 
        Relatorio gerado em {% if report_data.generated_at %}{{ report_data.generated_at|date:"d/m/Y H:i" }}{% else %}N/A{% endif %}
    </div>
</body>
</html>
